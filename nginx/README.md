# Nginx + Let's Encrypt SSL

ÐŸÑ€Ð¾ÑÑ‚Ð¾Ðµ Ñ€ÐµÑˆÐµÐ½Ð¸Ðµ Ð´Ð»Ñ Ð½Ð°ÑÑ‚Ñ€Ð¾Ð¹ÐºÐ¸ nginx Ñ SSL ÑÐµÑ€Ñ‚Ð¸Ñ„Ð¸ÐºÐ°Ñ‚Ð°Ð¼Ð¸ Ñ‡ÐµÑ€ÐµÐ· Let's Encrypt.

## ðŸ“‹ Ð¢Ñ€ÐµÐ±Ð¾Ð²Ð°Ð½Ð¸Ñ

ÐŸÐµÑ€ÐµÐ´ Ð½Ð°Ñ‡Ð°Ð»Ð¾Ð¼ Ñ€Ð°Ð±Ð¾Ñ‚Ñ‹ ÑƒÐ±ÐµÐ´Ð¸Ñ‚ÐµÑÑŒ, Ñ‡Ñ‚Ð¾ Ñƒ Ð²Ð°Ñ ÑƒÑÑ‚Ð°Ð½Ð¾Ð²Ð»ÐµÐ½Ð¾:

- **Docker** (Ð²ÐµÑ€ÑÐ¸Ñ 20.10 Ð¸Ð»Ð¸ Ð²Ñ‹ÑˆÐµ)
- **Docker Compose** (Ð²ÐµÑ€ÑÐ¸Ñ 2.0 Ð¸Ð»Ð¸ Ð²Ñ‹ÑˆÐµ, Ð¸Ð»Ð¸ docker-compose 1.29+)
- **ÐŸÑ€Ð°Ð²Ð° root** Ð¸Ð»Ð¸ Ð²Ð¾Ð·Ð¼Ð¾Ð¶Ð½Ð¾ÑÑ‚ÑŒ Ð²Ñ‹Ð¿Ð¾Ð»Ð½ÑÑ‚ÑŒ ÐºÐ¾Ð¼Ð°Ð½Ð´Ñ‹ Ñ‡ÐµÑ€ÐµÐ· `sudo`
- **Ð”Ð¾Ð¼ÐµÐ½**, ÐºÐ¾Ñ‚Ð¾Ñ€Ñ‹Ð¹ ÑƒÐºÐ°Ð·Ñ‹Ð²Ð°ÐµÑ‚ Ð½Ð° IP-Ð°Ð´Ñ€ÐµÑ Ð²Ð°ÑˆÐµÐ³Ð¾ ÑÐµÑ€Ð²ÐµÑ€Ð°
- **ÐžÑ‚ÐºÑ€Ñ‹Ñ‚Ñ‹Ðµ Ð¿Ð¾Ñ€Ñ‚Ñ‹ 80 Ð¸ 443** Ð² firewall

### ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° ÑƒÑÑ‚Ð°Ð½Ð¾Ð²ÐºÐ¸ Docker

```bash
# ÐŸÑ€Ð¾Ð²ÐµÑ€Ð¸Ñ‚ÑŒ Docker
docker --version

# ÐŸÑ€Ð¾Ð²ÐµÑ€Ð¸Ñ‚ÑŒ Docker Compose
docker compose version
# Ð¸Ð»Ð¸
docker-compose --version
```

Ð•ÑÐ»Ð¸ Docker Ð½Ðµ ÑƒÑÑ‚Ð°Ð½Ð¾Ð²Ð»ÐµÐ½, ÑƒÑÑ‚Ð°Ð½Ð¾Ð²Ð¸Ñ‚Ðµ ÐµÐ³Ð¾ ÑÐ¾Ð³Ð»Ð°ÑÐ½Ð¾ [Ð¾Ñ„Ð¸Ñ†Ð¸Ð°Ð»ÑŒÐ½Ð¾Ð¹ Ð´Ð¾ÐºÑƒÐ¼ÐµÐ½Ñ‚Ð°Ñ†Ð¸Ð¸](https://docs.docker.com/engine/install/ubuntu/).

## ðŸ“ Ð¡Ñ‚Ñ€ÑƒÐºÑ‚ÑƒÑ€Ð° Ð¿Ñ€Ð¾ÐµÐºÑ‚Ð°

```
nginx/
â”œâ”€â”€ docker-compose.yml          # Docker Compose ÐºÐ¾Ð½Ñ„Ð¸Ð³ÑƒÑ€Ð°Ñ†Ð¸Ñ
â”œâ”€â”€ generate_ssl.sh             # Ð¡ÐºÑ€Ð¸Ð¿Ñ‚ Ð´Ð»Ñ ÑƒÐ¿Ñ€Ð°Ð²Ð»ÐµÐ½Ð¸Ñ SSL Ð¸ nginx
â”œâ”€â”€ .gitignore                  # Ð˜Ð³Ð½Ð¾Ñ€Ð¸Ñ€ÑƒÐµÐ¼Ñ‹Ðµ Ñ„Ð°Ð¹Ð»Ñ‹ (ssl, www, logs)
â”œâ”€â”€ README.md                   # Ð­Ñ‚Ð° Ð´Ð¾ÐºÑƒÐ¼ÐµÐ½Ñ‚Ð°Ñ†Ð¸Ñ
â”œâ”€â”€ config/
â”‚   â”œâ”€â”€ nginx.conf.template     # Ð¨Ð°Ð±Ð»Ð¾Ð½ ÐºÐ¾Ð½Ñ„Ð¸Ð³ÑƒÑ€Ð°Ñ†Ð¸Ð¸ nginx (Ñ SSL)
â”‚   â””â”€â”€ nginx-init.conf         # Ð’Ñ€ÐµÐ¼ÐµÐ½Ð½Ð°Ñ ÐºÐ¾Ð½Ñ„Ð¸Ð³ÑƒÑ€Ð°Ñ†Ð¸Ñ (Ð±ÐµÐ· SSL)
â”œâ”€â”€ ssl/                        # SSL ÑÐµÑ€Ñ‚Ð¸Ñ„Ð¸ÐºÐ°Ñ‚Ñ‹ (ÑÐ¾Ð·Ð´Ð°ÐµÑ‚ÑÑ Ð°Ð²Ñ‚Ð¾Ð¼Ð°Ñ‚Ð¸Ñ‡ÐµÑÐºÐ¸)
â””â”€â”€ www/                        # Challenge Ñ„Ð°Ð¹Ð»Ñ‹ Ð´Ð»Ñ Let's Encrypt (ÑÐ¾Ð·Ð´Ð°ÐµÑ‚ÑÑ Ð°Ð²Ñ‚Ð¾Ð¼Ð°Ñ‚Ð¸Ñ‡ÐµÑÐºÐ¸)
```

## ðŸš€ Ð‘Ñ‹ÑÑ‚Ñ€Ñ‹Ð¹ ÑÑ‚Ð°Ñ€Ñ‚

### Ð¨Ð°Ð³ 1: ÐÐ°ÑÑ‚Ñ€Ð¾Ð¹ÐºÐ° Ð¿Ñ€Ð°Ð² Ð´Ð¾ÑÑ‚ÑƒÐ¿Ð°

Ð’Ñ‹Ð´Ð°Ð¹Ñ‚Ðµ Ð¿Ñ€Ð°Ð²Ð° Ð½Ð° Ð²Ñ‹Ð¿Ð¾Ð»Ð½ÐµÐ½Ð¸Ðµ ÑÐºÑ€Ð¸Ð¿Ñ‚Ñƒ:

```bash
cd /path/to/unicchat/nginx
chmod +x generate_ssl.sh
```

### Ð¨Ð°Ð³ 2: ÐÐ°ÑÑ‚Ñ€Ð¾Ð¹ÐºÐ° Ð´Ð¾Ð¼ÐµÐ½Ð°

Ð¡Ð¾Ð·Ð´Ð°Ð¹Ñ‚Ðµ Ñ„Ð°Ð¹Ð» `domain.usr.txt` Ð² ÐºÐ¾Ñ€Ð½Ðµ Ð¿Ñ€Ð¾ÐµÐºÑ‚Ð° (Ð½Ð° ÑƒÑ€Ð¾Ð²ÐµÐ½ÑŒ Ð²Ñ‹ÑˆÐµ Ð´Ð¸Ñ€ÐµÐºÑ‚Ð¾Ñ€Ð¸Ð¸ `nginx/`):

```bash
cd /path/to/unicchat
cat > domain.usr.txt << EOF
DOMAIN=yourdomain.com
EMAIL=your@email.com
EOF
```

**Ð’Ð°Ð¶Ð½Ð¾:**
- Ð—Ð°Ð¼ÐµÐ½Ð¸Ñ‚Ðµ `yourdomain.com` Ð½Ð° Ð²Ð°Ñˆ Ñ€ÐµÐ°Ð»ÑŒÐ½Ñ‹Ð¹ Ð´Ð¾Ð¼ÐµÐ½
- Ð—Ð°Ð¼ÐµÐ½Ð¸Ñ‚Ðµ `your@email.com` Ð½Ð° Ð²Ð°Ñˆ email (Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐµÑ‚ÑÑ Let's Encrypt Ð´Ð»Ñ ÑƒÐ²ÐµÐ´Ð¾Ð¼Ð»ÐµÐ½Ð¸Ð¹)
- Ð£Ð±ÐµÐ´Ð¸Ñ‚ÐµÑÑŒ, Ñ‡Ñ‚Ð¾ Ð´Ð¾Ð¼ÐµÐ½ ÑƒÐºÐ°Ð·Ñ‹Ð²Ð°ÐµÑ‚ Ð½Ð° IP-Ð°Ð´Ñ€ÐµÑ Ð²Ð°ÑˆÐµÐ³Ð¾ ÑÐµÑ€Ð²ÐµÑ€Ð°:
  ```bash
  dig yourdomain.com +short
  ```

### Ð¨Ð°Ð³ 3: ÐÐ°ÑÑ‚Ñ€Ð¾Ð¹ÐºÐ° upstream ÑÐµÑ€Ð²ÐµÑ€Ð°

**Ð’ÐÐ–ÐÐž:** Ð¡Ð´ÐµÐ»Ð°Ð¹Ñ‚Ðµ ÑÑ‚Ð¾ ÐŸÐ•Ð Ð•Ð” Ð³ÐµÐ½ÐµÑ€Ð°Ñ†Ð¸ÐµÐ¹ SSL!

ÐžÑ‚Ñ€ÐµÐ´Ð°ÐºÑ‚Ð¸Ñ€ÑƒÐ¹Ñ‚Ðµ `config/nginx.conf.template` Ð¸ Ð¸Ð·Ð¼ÐµÐ½Ð¸Ñ‚Ðµ Ð°Ð´Ñ€ÐµÑ upstream ÑÐµÑ€Ð²ÐµÑ€Ð°:

```nginx
upstream internal {
    server 127.0.0.1:8080;  # Ð—Ð°Ð¼ÐµÐ½Ð¸Ñ‚Ðµ Ð½Ð° Ð°Ð´Ñ€ÐµÑ Ð²Ð°ÑˆÐµÐ³Ð¾ Ð¿Ñ€Ð¸Ð»Ð¾Ð¶ÐµÐ½Ð¸Ñ
}
```

Ð¢Ð°ÐºÐ¶Ðµ Ð¾Ð±Ð½Ð¾Ð²Ð¸Ñ‚Ðµ `config/nginx-init.conf` (Ð´Ð¾Ð»Ð¶Ð½Ð¾ ÑÐ¾Ð²Ð¿Ð°Ð´Ð°Ñ‚ÑŒ Ñ Ð¾ÑÐ½Ð¾Ð²Ð½Ñ‹Ð¼ ÑˆÐ°Ð±Ð»Ð¾Ð½Ð¾Ð¼).

**ÐŸÑ€Ð¸Ð¼ÐµÑ€Ñ‹ upstream:**
- Ð›Ð¾ÐºÐ°Ð»ÑŒÐ½Ñ‹Ð¹ ÑÐµÑ€Ð²ÐµÑ€: `server 127.0.0.1:8080;`
- Docker ÐºÐ¾Ð½Ñ‚ÐµÐ¹Ð½ÐµÑ€: `server app-container:8080;`
- Ð’Ð½ÐµÑˆÐ½Ð¸Ð¹ ÑÐµÑ€Ð²ÐµÑ€: `server 192.168.1.100:8080;`

### Ð¨Ð°Ð³ 4: ÐÐ°ÑÑ‚Ñ€Ð¾Ð¹ÐºÐ° firewall

Ð£Ð±ÐµÐ´Ð¸Ñ‚ÐµÑÑŒ, Ñ‡Ñ‚Ð¾ Ð¿Ð¾Ñ€Ñ‚Ñ‹ 80 Ð¸ 443 Ð¾Ñ‚ÐºÑ€Ñ‹Ñ‚Ñ‹:

```bash
# Ð”Ð»Ñ UFW
sudo ufw allow 80/tcp
sudo ufw allow 443/tcp
sudo ufw reload

# ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ°
sudo ufw status
```

### Ð¨Ð°Ð³ 5: Ð“ÐµÐ½ÐµÑ€Ð°Ñ†Ð¸Ñ SSL ÑÐµÑ€Ñ‚Ð¸Ñ„Ð¸ÐºÐ°Ñ‚Ð°

Ð—Ð°Ð¿ÑƒÑÑ‚Ð¸Ñ‚Ðµ ÑÐºÑ€Ð¸Ð¿Ñ‚ Ñ Ð¿Ñ€Ð°Ð²Ð°Ð¼Ð¸ root:

```bash
cd /path/to/unicchat/nginx
sudo ./generate_ssl.sh
```

Ð’ Ð¼ÐµÐ½ÑŽ Ð²Ñ‹Ð±ÐµÑ€Ð¸Ñ‚Ðµ Ð¾Ð¿Ñ†Ð¸ÑŽ **[1] ðŸ” Ð“ÐµÐ½ÐµÑ€Ð°Ñ†Ð¸Ñ SSL ÑÐµÑ€Ñ‚Ð¸Ñ„Ð¸ÐºÐ°Ñ‚Ð° (Let's Encrypt)**

Ð¡ÐºÑ€Ð¸Ð¿Ñ‚ Ð°Ð²Ñ‚Ð¾Ð¼Ð°Ñ‚Ð¸Ñ‡ÐµÑÐºÐ¸ Ð²Ñ‹Ð¿Ð¾Ð»Ð½Ð¸Ñ‚:
1. âœ… ÐžÑÑ‚Ð°Ð½Ð¾Ð²Ð¸Ñ‚ nginx (ÐµÑÐ»Ð¸ Ð·Ð°Ð¿ÑƒÑ‰ÐµÐ½) - Ð¾ÑÐ²Ð¾Ð±Ð¾Ð´Ð¸Ñ‚ Ð¿Ð¾Ñ€Ñ‚ 80
2. âœ… ÐŸÐ¾Ð»ÑƒÑ‡Ð¸Ñ‚ SSL ÑÐµÑ€Ñ‚Ð¸Ñ„Ð¸ÐºÐ°Ñ‚ Ñ‡ÐµÑ€ÐµÐ· Let's Encrypt (standalone Ñ€ÐµÐ¶Ð¸Ð¼)
3. âœ… ÐžÐ±Ð½Ð¾Ð²Ð¸Ñ‚ ÐºÐ¾Ð½Ñ„Ð¸Ð³ÑƒÑ€Ð°Ñ†Ð¸ÑŽ nginx Ñ Ð²Ð°ÑˆÐ¸Ð¼ Ð´Ð¾Ð¼ÐµÐ½Ð¾Ð¼
4. âœ… Ð—Ð°Ð¿ÑƒÑÑ‚Ð¸Ñ‚ nginx Ñ SSL ÑÐµÑ€Ñ‚Ð¸Ñ„Ð¸ÐºÐ°Ñ‚Ð¾Ð¼

### Ð¨Ð°Ð³ 6: ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° Ñ€Ð°Ð±Ð¾Ñ‚Ñ‹

```bash
# ÐŸÑ€Ð¾Ð²ÐµÑ€Ð¸Ñ‚ÑŒ ÑÑ‚Ð°Ñ‚ÑƒÑ nginx
curl -I https://yourdomain.com

# Ð˜Ð»Ð¸ Ñ‡ÐµÑ€ÐµÐ· Ð±Ñ€Ð°ÑƒÐ·ÐµÑ€
# ÐžÑ‚ÐºÑ€Ð¾Ð¹Ñ‚Ðµ https://yourdomain.com
```

## ðŸ“– ÐŸÐ¾Ð´Ñ€Ð¾Ð±Ð½Ð¾Ðµ Ñ€ÑƒÐºÐ¾Ð²Ð¾Ð´ÑÑ‚Ð²Ð¾

### ÐœÐµÐ½ÑŽ ÑÐºÑ€Ð¸Ð¿Ñ‚Ð°

ÐŸÐ¾ÑÐ»Ðµ Ð·Ð°Ð¿ÑƒÑÐºÐ° `sudo ./generate_ssl.sh` Ð´Ð¾ÑÑ‚ÑƒÐ¿Ð½Ñ‹ ÑÐ»ÐµÐ´ÑƒÑŽÑ‰Ð¸Ðµ Ð¾Ð¿Ñ†Ð¸Ð¸:

- **[1] ðŸ” Ð“ÐµÐ½ÐµÑ€Ð°Ñ†Ð¸Ñ SSL ÑÐµÑ€Ñ‚Ð¸Ñ„Ð¸ÐºÐ°Ñ‚Ð°** - ÐŸÐ¾Ð»ÑƒÑ‡Ð¸Ñ‚ÑŒ Ð½Ð¾Ð²Ñ‹Ð¹ SSL ÑÐµÑ€Ñ‚Ð¸Ñ„Ð¸ÐºÐ°Ñ‚ Ð¾Ñ‚ Let's Encrypt
- **[2] ðŸ“ Ð“ÐµÐ½ÐµÑ€Ð°Ñ†Ð¸Ñ/Ð¾Ð±Ð½Ð¾Ð²Ð»ÐµÐ½Ð¸Ðµ ÐºÐ¾Ð½Ñ„Ð¸Ð³ÑƒÑ€Ð°Ñ†Ð¸Ð¸ nginx** - ÐžÐ±Ð½Ð¾Ð²Ð¸Ñ‚ÑŒ ÐºÐ¾Ð½Ñ„Ð¸Ð³ÑƒÑ€Ð°Ñ†Ð¸ÑŽ Ð¸Ð· ÑˆÐ°Ð±Ð»Ð¾Ð½Ð°
- **[3] ðŸŒ Ð—Ð°Ð¿ÑƒÑÐº nginx** - Ð—Ð°Ð¿ÑƒÑÑ‚Ð¸Ñ‚ÑŒ ÐºÐ¾Ð½Ñ‚ÐµÐ¹Ð½ÐµÑ€ nginx
- **[4] ðŸ›‘ ÐžÑÑ‚Ð°Ð½Ð¾Ð²ÐºÐ° nginx** - ÐžÑÑ‚Ð°Ð½Ð¾Ð²Ð¸Ñ‚ÑŒ ÐºÐ¾Ð½Ñ‚ÐµÐ¹Ð½ÐµÑ€ nginx
- **[5] ðŸ”„ ÐŸÐµÑ€ÐµÐ·Ð°Ð¿ÑƒÑÐº nginx** - ÐŸÐµÑ€ÐµÐ·Ð°Ð¿ÑƒÑÑ‚Ð¸Ñ‚ÑŒ ÐºÐ¾Ð½Ñ‚ÐµÐ¹Ð½ÐµÑ€ nginx
- **[6] ðŸ“Š Ð¡Ñ‚Ð°Ñ‚ÑƒÑ ÑÐµÑ€Ð²Ð¸ÑÐ¾Ð²** - ÐŸÐ¾ÐºÐ°Ð·Ð°Ñ‚ÑŒ ÑÑ‚Ð°Ñ‚ÑƒÑ nginx, certbot Ð¸ SSL ÑÐµÑ€Ñ‚Ð¸Ñ„Ð¸ÐºÐ°Ñ‚Ð¾Ð²
- **[7] ðŸ“‹ Ð›Ð¾Ð³Ð¸ nginx** - ÐŸÐ¾ÐºÐ°Ð·Ð°Ñ‚ÑŒ Ð¿Ð¾ÑÐ»ÐµÐ´Ð½Ð¸Ðµ Ð»Ð¾Ð³Ð¸ nginx
- **[8] ðŸ“‹ Ð›Ð¾Ð³Ð¸ certbot** - ÐŸÐ¾ÐºÐ°Ð·Ð°Ñ‚ÑŒ Ð¿Ð¾ÑÐ»ÐµÐ´Ð½Ð¸Ðµ Ð»Ð¾Ð³Ð¸ certbot
- **[9] ðŸ” ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° ÐºÐ¾Ð½Ñ„Ð¸Ð³ÑƒÑ€Ð°Ñ†Ð¸Ð¸ nginx** - ÐŸÑ€Ð¾Ð²ÐµÑ€Ð¸Ñ‚ÑŒ ÑÐ¸Ð½Ñ‚Ð°ÐºÑÐ¸Ñ ÐºÐ¾Ð½Ñ„Ð¸Ð³ÑƒÑ€Ð°Ñ†Ð¸Ð¸
- **[0] ðŸšª Ð’Ñ‹Ñ…Ð¾Ð´** - Ð’Ñ‹Ð¹Ñ‚Ð¸ Ð¸Ð· Ð¼ÐµÐ½ÑŽ

### Ð ÑƒÑ‡Ð½Ð°Ñ Ð½Ð°ÑÑ‚Ñ€Ð¾Ð¹ÐºÐ° (Ð¿Ð¾ÑˆÐ°Ð³Ð¾Ð²Ð¾)

Ð•ÑÐ»Ð¸ Ð²Ñ‹ Ñ…Ð¾Ñ‚Ð¸Ñ‚Ðµ Ð²Ñ‹Ð¿Ð¾Ð»Ð½Ð¸Ñ‚ÑŒ ÑˆÐ°Ð³Ð¸ Ð²Ñ€ÑƒÑ‡Ð½ÑƒÑŽ:

1. **ÐÐ°ÑÑ‚Ñ€Ð¾Ð¹Ñ‚Ðµ upstream** Ð² `config/nginx.conf.template` Ð¸ `config/nginx-init.conf`

2. **Ð¡Ð³ÐµÐ½ÐµÑ€Ð¸Ñ€ÑƒÐ¹Ñ‚Ðµ ÐºÐ¾Ð½Ñ„Ð¸Ð³ÑƒÑ€Ð°Ñ†Ð¸ÑŽ** (Ð¾Ð¿Ñ†Ð¸Ñ 2 Ð² Ð¼ÐµÐ½ÑŽ):
   ```bash
   sudo ./generate_ssl.sh
   # Ð’Ñ‹Ð±ÐµÑ€Ð¸Ñ‚Ðµ Ð¾Ð¿Ñ†Ð¸ÑŽ 2
   ```

3. **Ð—Ð°Ð¿ÑƒÑÑ‚Ð¸Ñ‚Ðµ nginx** (Ð¾Ð¿Ñ†Ð¸Ñ 3 Ð² Ð¼ÐµÐ½ÑŽ):
   ```bash
   sudo ./generate_ssl.sh
   # Ð’Ñ‹Ð±ÐµÑ€Ð¸Ñ‚Ðµ Ð¾Ð¿Ñ†Ð¸ÑŽ 3
   ```

4. **Ð¡Ð³ÐµÐ½ÐµÑ€Ð¸Ñ€ÑƒÐ¹Ñ‚Ðµ SSL ÑÐµÑ€Ñ‚Ð¸Ñ„Ð¸ÐºÐ°Ñ‚** (Ð¾Ð¿Ñ†Ð¸Ñ 1 Ð² Ð¼ÐµÐ½ÑŽ):
   ```bash
   sudo ./generate_ssl.sh
   # Ð’Ñ‹Ð±ÐµÑ€Ð¸Ñ‚Ðµ Ð¾Ð¿Ñ†Ð¸ÑŽ 1
   ```

## ðŸ”„ ÐÐ²Ñ‚Ð¾Ð¼Ð°Ñ‚Ð¸Ñ‡ÐµÑÐºÐ¾Ðµ Ð¾Ð±Ð½Ð¾Ð²Ð»ÐµÐ½Ð¸Ðµ ÑÐµÑ€Ñ‚Ð¸Ñ„Ð¸ÐºÐ°Ñ‚Ð¾Ð²

Certbot Ð°Ð²Ñ‚Ð¾Ð¼Ð°Ñ‚Ð¸Ñ‡ÐµÑÐºÐ¸ Ð¾Ð±Ð½Ð¾Ð²Ð»ÑÐµÑ‚ SSL ÑÐµÑ€Ñ‚Ð¸Ñ„Ð¸ÐºÐ°Ñ‚Ñ‹ ÐºÐ°Ð¶Ð´Ñ‹Ðµ 12 Ñ‡Ð°ÑÐ¾Ð² Ñ‡ÐµÑ€ÐµÐ· ÐºÐ¾Ð½Ñ‚ÐµÐ¹Ð½ÐµÑ€ `unicchat.certbot`.

Ð¡ÐµÑ€Ñ‚Ð¸Ñ„Ð¸ÐºÐ°Ñ‚Ñ‹ Let's Encrypt Ð´ÐµÐ¹ÑÑ‚Ð²Ð¸Ñ‚ÐµÐ»ÑŒÐ½Ñ‹ 90 Ð´Ð½ÐµÐ¹ Ð¸ Ð¾Ð±Ð½Ð¾Ð²Ð»ÑÑŽÑ‚ÑÑ Ð°Ð²Ñ‚Ð¾Ð¼Ð°Ñ‚Ð¸Ñ‡ÐµÑÐºÐ¸ Ð·Ð° 30 Ð´Ð½ÐµÐ¹ Ð´Ð¾ Ð¸ÑÑ‚ÐµÑ‡ÐµÐ½Ð¸Ñ.

## ðŸ”§ Troubleshooting

### ÐŸÑ€Ð¾Ð±Ð»ÐµÐ¼Ð°: ÐŸÐ¾Ñ€Ñ‚ 80 Ð·Ð°Ð½ÑÑ‚

```bash
# ÐŸÑ€Ð¾Ð²ÐµÑ€Ð¸Ñ‚ÑŒ Ñ‡Ñ‚Ð¾ Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐµÑ‚ Ð¿Ð¾Ñ€Ñ‚ 80
sudo ss -tulpn | grep :80
# Ð¸Ð»Ð¸
sudo netstat -tulpn | grep :80

# ÐžÑÑ‚Ð°Ð½Ð¾Ð²Ð¸Ñ‚ÑŒ nginx ÐµÑÐ»Ð¸ Ð·Ð°Ð¿ÑƒÑ‰ÐµÐ½
sudo ./generate_ssl.sh
# Ð’Ñ‹Ð±ÐµÑ€Ð¸Ñ‚Ðµ Ð¾Ð¿Ñ†Ð¸ÑŽ 4 (ÐžÑÑ‚Ð°Ð½Ð¾Ð²ÐºÐ° nginx)
```

### ÐŸÑ€Ð¾Ð±Ð»ÐµÐ¼Ð°: ÐÐµ ÑƒÐ´Ð°ÐµÑ‚ÑÑ Ð¿Ð¾Ð»ÑƒÑ‡Ð¸Ñ‚ÑŒ SSL ÑÐµÑ€Ñ‚Ð¸Ñ„Ð¸ÐºÐ°Ñ‚

ÐŸÑ€Ð¾Ð²ÐµÑ€ÑŒÑ‚Ðµ:

1. **Ð”Ð¾Ð¼ÐµÐ½ ÑƒÐºÐ°Ð·Ñ‹Ð²Ð°ÐµÑ‚ Ð½Ð° IP ÑÐµÑ€Ð²ÐµÑ€Ð°:**
   ```bash
   dig yourdomain.com +short
   # Ð”Ð¾Ð»Ð¶ÐµÐ½ Ð²ÐµÑ€Ð½ÑƒÑ‚ÑŒ IP Ð²Ð°ÑˆÐµÐ³Ð¾ ÑÐµÑ€Ð²ÐµÑ€Ð°
   ```

2. **ÐŸÐ¾Ñ€Ñ‚ 80 Ð´Ð¾ÑÑ‚ÑƒÐ¿ÐµÐ½ Ð¸Ð·Ð²Ð½Ðµ:**
   ```bash
   # Ð¡ Ð´Ñ€ÑƒÐ³Ð¾Ð³Ð¾ ÐºÐ¾Ð¼Ð¿ÑŒÑŽÑ‚ÐµÑ€Ð°
   curl http://yourdomain.com
   ```

3. **Firewall Ð¾Ñ‚ÐºÑ€Ñ‹Ñ‚:**
   ```bash
   sudo ufw status
   sudo ufw allow 80/tcp
   sudo ufw allow 443/tcp
   ```

4. **Cloud provider firewall/security groups:**
   - Ð£Ð±ÐµÐ´Ð¸Ñ‚ÐµÑÑŒ, Ñ‡Ñ‚Ð¾ Ð² Ð½Ð°ÑÑ‚Ñ€Ð¾Ð¹ÐºÐ°Ñ… Ð²Ð°ÑˆÐµÐ³Ð¾ Ð¾Ð±Ð»Ð°Ñ‡Ð½Ð¾Ð³Ð¾ Ð¿Ñ€Ð¾Ð²Ð°Ð¹Ð´ÐµÑ€Ð° Ð¾Ñ‚ÐºÑ€Ñ‹Ñ‚Ñ‹ Ð¿Ð¾Ñ€Ñ‚Ñ‹ 80 Ð¸ 443

### ÐŸÑ€Ð¾Ð±Ð»ÐµÐ¼Ð°: Nginx Ð½Ðµ Ð·Ð°Ð¿ÑƒÑÐºÐ°ÐµÑ‚ÑÑ

```bash
# ÐŸÑ€Ð¾Ð²ÐµÑ€Ð¸Ñ‚ÑŒ Ð»Ð¾Ð³Ð¸
sudo ./generate_ssl.sh
# Ð’Ñ‹Ð±ÐµÑ€Ð¸Ñ‚Ðµ Ð¾Ð¿Ñ†Ð¸ÑŽ 7 (Ð›Ð¾Ð³Ð¸ nginx)

# ÐŸÑ€Ð¾Ð²ÐµÑ€Ð¸Ñ‚ÑŒ ÐºÐ¾Ð½Ñ„Ð¸Ð³ÑƒÑ€Ð°Ñ†Ð¸ÑŽ
sudo ./generate_ssl.sh
# Ð’Ñ‹Ð±ÐµÑ€Ð¸Ñ‚Ðµ Ð¾Ð¿Ñ†Ð¸ÑŽ 9 (ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° ÐºÐ¾Ð½Ñ„Ð¸Ð³ÑƒÑ€Ð°Ñ†Ð¸Ð¸)
```

### ÐŸÑ€Ð¾Ð±Ð»ÐµÐ¼Ð°: SSL ÑÐµÑ€Ñ‚Ð¸Ñ„Ð¸ÐºÐ°Ñ‚ Ð½Ðµ Ð½Ð°Ð¹Ð´ÐµÐ½

```bash
# ÐŸÑ€Ð¾Ð²ÐµÑ€Ð¸Ñ‚ÑŒ Ð½Ð°Ð»Ð¸Ñ‡Ð¸Ðµ ÑÐµÑ€Ñ‚Ð¸Ñ„Ð¸ÐºÐ°Ñ‚Ð¾Ð²
ls -la ssl/live/yourdomain.com/

# Ð•ÑÐ»Ð¸ ÑÐµÑ€Ñ‚Ð¸Ñ„Ð¸ÐºÐ°Ñ‚Ð¾Ð² Ð½ÐµÑ‚, ÑÐ³ÐµÐ½ÐµÑ€Ð¸Ñ€ÑƒÐ¹Ñ‚Ðµ Ð·Ð°Ð½Ð¾Ð²Ð¾
sudo ./generate_ssl.sh
# Ð’Ñ‹Ð±ÐµÑ€Ð¸Ñ‚Ðµ Ð¾Ð¿Ñ†Ð¸ÑŽ 1 (Ð“ÐµÐ½ÐµÑ€Ð°Ñ†Ð¸Ñ SSL ÑÐµÑ€Ñ‚Ð¸Ñ„Ð¸ÐºÐ°Ñ‚Ð°)
```

### ÐŸÑ€Ð¾Ð±Ð»ÐµÐ¼Ð°: Permission denied Ð¿Ñ€Ð¸ Ð·Ð°Ð¿ÑƒÑÐºÐµ ÑÐºÑ€Ð¸Ð¿Ñ‚Ð°

```bash
# Ð’Ñ‹Ð´Ð°Ñ‚ÑŒ Ð¿Ñ€Ð°Ð²Ð° Ð½Ð° Ð²Ñ‹Ð¿Ð¾Ð»Ð½ÐµÐ½Ð¸Ðµ
chmod +x generate_ssl.sh

# Ð—Ð°Ð¿ÑƒÑÐºÐ°Ñ‚ÑŒ Ñ sudo
sudo ./generate_ssl.sh
```

### ÐŸÑ€Ð¾ÑÐ¼Ð¾Ñ‚Ñ€ Ð»Ð¾Ð³Ð¾Ð²

```bash
# Ð›Ð¾Ð³Ð¸ nginx
docker logs unicchat.nginx

# Ð›Ð¾Ð³Ð¸ certbot
docker logs unicchat.certbot

# Ð˜Ð»Ð¸ Ñ‡ÐµÑ€ÐµÐ· Ð¼ÐµÐ½ÑŽ ÑÐºÑ€Ð¸Ð¿Ñ‚Ð° (Ð¾Ð¿Ñ†Ð¸Ð¸ 7 Ð¸ 8)
```

## ðŸ“ Ð’Ð°Ð¶Ð½Ñ‹Ðµ Ð·Ð°Ð¼ÐµÑ‡Ð°Ð½Ð¸Ñ

1. **Ð¤Ð°Ð¹Ð» `domain.usr.txt`** Ð´Ð¾Ð»Ð¶ÐµÐ½ Ð½Ð°Ñ…Ð¾Ð´Ð¸Ñ‚ÑŒÑÑ Ð½Ð° ÑƒÑ€Ð¾Ð²ÐµÐ½ÑŒ Ð²Ñ‹ÑˆÐµ Ð´Ð¸Ñ€ÐµÐºÑ‚Ð¾Ñ€Ð¸Ð¸ `nginx/` (Ð² ÐºÐ¾Ñ€Ð½Ðµ Ð¿Ñ€Ð¾ÐµÐºÑ‚Ð°)

2. **SSL ÑÐµÑ€Ñ‚Ð¸Ñ„Ð¸ÐºÐ°Ñ‚Ñ‹** Ñ…Ñ€Ð°Ð½ÑÑ‚ÑÑ Ð² `nginx/ssl/` Ð¸ Ð°Ð²Ñ‚Ð¾Ð¼Ð°Ñ‚Ð¸Ñ‡ÐµÑÐºÐ¸ Ð¾Ð±Ð½Ð¾Ð²Ð»ÑÑŽÑ‚ÑÑ

3. **ÐšÐ¾Ð½Ñ„Ð¸Ð³ÑƒÑ€Ð°Ñ†Ð¸Ñ nginx** Ð³ÐµÐ½ÐµÑ€Ð¸Ñ€ÑƒÐµÑ‚ÑÑ Ð¸Ð· ÑˆÐ°Ð±Ð»Ð¾Ð½Ð° `config/nginx.conf.template` Ñ Ð¿Ð¾Ð´ÑÑ‚Ð°Ð½Ð¾Ð²ÐºÐ¾Ð¹ Ð´Ð¾Ð¼ÐµÐ½Ð°

4. **ÐŸÐ¾Ñ€Ñ‚ 80** Ð´Ð¾Ð»Ð¶ÐµÐ½ Ð±Ñ‹Ñ‚ÑŒ ÑÐ²Ð¾Ð±Ð¾Ð´ÐµÐ½ Ð²Ð¾ Ð²Ñ€ÐµÐ¼Ñ Ð³ÐµÐ½ÐµÑ€Ð°Ñ†Ð¸Ð¸ SSL ÑÐµÑ€Ñ‚Ð¸Ñ„Ð¸ÐºÐ°Ñ‚Ð° (ÑÐºÑ€Ð¸Ð¿Ñ‚ Ð°Ð²Ñ‚Ð¾Ð¼Ð°Ñ‚Ð¸Ñ‡ÐµÑÐºÐ¸ Ð¾ÑÑ‚Ð°Ð½Ð°Ð²Ð»Ð¸Ð²Ð°ÐµÑ‚ nginx)

5. **Docker ÑÐµÑ‚ÑŒ** `unicchat-network` ÑÐ¾Ð·Ð´Ð°ÐµÑ‚ÑÑ Ð°Ð²Ñ‚Ð¾Ð¼Ð°Ñ‚Ð¸Ñ‡ÐµÑÐºÐ¸ Ð¿Ñ€Ð¸ Ð¿ÐµÑ€Ð²Ð¾Ð¼ Ð·Ð°Ð¿ÑƒÑÐºÐµ

## ðŸ”’ Ð‘ÐµÐ·Ð¾Ð¿Ð°ÑÐ½Ð¾ÑÑ‚ÑŒ

- Ð¤Ð°Ð¹Ð» `domain.usr.txt` ÑÐ¾Ð´ÐµÑ€Ð¶Ð¸Ñ‚ Ð¿ÐµÑ€ÑÐ¾Ð½Ð°Ð»ÑŒÐ½Ñ‹Ðµ Ð´Ð°Ð½Ð½Ñ‹Ðµ Ð¸ Ð½Ðµ Ð´Ð¾Ð»Ð¶ÐµÐ½ Ð¿Ð¾Ð¿Ð°Ð´Ð°Ñ‚ÑŒ Ð² git (Ð´Ð¾Ð±Ð°Ð²Ð»ÐµÐ½ Ð² `.gitignore`)
- SSL ÑÐµÑ€Ñ‚Ð¸Ñ„Ð¸ÐºÐ°Ñ‚Ñ‹ Ð¸ Ð¿Ñ€Ð¸Ð²Ð°Ñ‚Ð½Ñ‹Ðµ ÐºÐ»ÑŽÑ‡Ð¸ Ñ…Ñ€Ð°Ð½ÑÑ‚ÑÑ Ð² `ssl/` Ð¸ Ð½Ðµ Ð´Ð¾Ð»Ð¶Ð½Ñ‹ Ð±Ñ‹Ñ‚ÑŒ Ð´Ð¾ÑÑ‚ÑƒÐ¿Ð½Ñ‹ Ð¿ÑƒÐ±Ð»Ð¸Ñ‡Ð½Ð¾
- Ð¡ÐºÑ€Ð¸Ð¿Ñ‚ Ñ‚Ñ€ÐµÐ±ÑƒÐµÑ‚ Ð¿Ñ€Ð°Ð²Ð° root Ð´Ð»Ñ Ñ€Ð°Ð±Ð¾Ñ‚Ñ‹ Ñ Docker Ð¸ ÑÐ¸ÑÑ‚ÐµÐ¼Ð½Ñ‹Ð¼Ð¸ Ð¿Ð¾Ñ€Ñ‚Ð°Ð¼Ð¸

## ðŸ“š Ð”Ð¾Ð¿Ð¾Ð»Ð½Ð¸Ñ‚ÐµÐ»ÑŒÐ½Ñ‹Ðµ Ñ€ÐµÑÑƒÑ€ÑÑ‹

- [Ð”Ð¾ÐºÑƒÐ¼ÐµÐ½Ñ‚Ð°Ñ†Ð¸Ñ Nginx](https://nginx.org/ru/docs/)
- [Ð”Ð¾ÐºÑƒÐ¼ÐµÐ½Ñ‚Ð°Ñ†Ð¸Ñ Let's Encrypt](https://letsencrypt.org/docs/)
- [Ð”Ð¾ÐºÑƒÐ¼ÐµÐ½Ñ‚Ð°Ñ†Ð¸Ñ Certbot](https://eff-certbot.readthedocs.io/)
- [Ð”Ð¾ÐºÑƒÐ¼ÐµÐ½Ñ‚Ð°Ñ†Ð¸Ñ Docker](https://docs.docker.com/)
